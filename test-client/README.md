# PDF Module Test Client

A standalone HTML/CSS/JS test client for testing the PDF Module integration workflow.

## Overview

This test client demonstrates the complete integration flow:
1. Register a domain via the PDF Module API to get an API key
2. Load the PDF editor in an iframe
3. Pass authentication and PDF data via postMessage

## How to Use

### Option 1: Open directly in browser

1. Start your PDF Module server:
   ```bash
   cd /path/to/pdf-module
   npm run dev
   ```

2. Open the test client directly in your browser:
   - Open `test-client/index.html` in your browser
   - Or use the "Open with Live Server" VS Code extension

### Option 2: Serve with a simple HTTP server

1. Start your PDF Module server (port 3000)

2. Serve the test client (e.g., port 8080):
   ```bash
   cd test-client
   npx serve -p 8080
   # or
   python -m http.server 8080
   ```

3. Open http://localhost:8080 in your browser

## Configuration

### Required Settings

1. **PDF Module Base URL**: The URL where your PDF Module is running (default: `http://localhost:3000`)

2. **Master API Key**: The `API_KEY` from your PDF Module's `.env` file (required for domain registration in production mode; optional in development mode)

3. **PDF File URL**: A publicly accessible URL to a PDF file to load in the editor

### Optional Settings

- **Custom File Name**: Override the PDF file name
- **Domain**: The domain name to register (auto-generated by default)
- **Webhook URL**: URL to receive notifications (a dummy URL is generated if not provided)

## Workflow

1. **Enter Configuration**
   - Set the PDF Module base URL
   - Enter your master API key
   - Provide a PDF file URL

2. **Register Domain**
   - Click "Register Domain & Get API Key"
   - This calls `POST /api/domains/register`
   - You'll receive an API key on success

3. **Launch PDF Editor**
   - Click "Launch PDF Editor"
   - The iframe loads the PDF Module
   - Data is sent via `postMessage`

4. **Edit PDF**
   - Use the PDF editor normally
   - The API key is used for authentication

## PostMessage API

### Sending Data to PDF Editor

```javascript
iframe.contentWindow.postMessage({
  type: 'PDF_EDITOR_INIT',
  fileUrl: 'https://example.com/document.pdf',
  fileName: 'my-document.pdf',
  apiKey: 'pdf_sk_xxxxx',
  fieldData: {
    fields: [...],
    metadata: {...}
  },
  config: {
    domain: 'example.com',
    webhook: 'https://example.com/webhook'
  }
}, 'http://localhost:3000');
```

### Receiving Messages from PDF Editor

```javascript
window.addEventListener('message', (event) => {
  switch (event.data.type) {
    case 'PDF_EDITOR_READY':
      // Editor is loaded and ready
      break;
    case 'PDF_SAVED':
      // PDF was saved
      break;
    case 'FIELD_UPDATED':
      // A field was updated
      break;
    case 'PDF_EDITOR_ERROR':
      // An error occurred
      break;
  }
});
```

## Troubleshooting

### "Unauthorized - Invalid master key"
- Make sure you've entered the correct API_KEY from your PDF Module's `.env` file
- In development mode (NODE_ENV=development), the master key might be optional

### "Domain is already registered"
- Use a different domain name
- Or use the existing domain's API key
- Domain names are auto-generated with timestamps to avoid conflicts

### CORS Errors
- Ensure the PDF Module allows requests from your test client's origin
- In development, this should work by default

### Iframe Not Loading
- Check that the PDF Module server is running
- Verify the base URL is correct
- Check browser console for errors

## File Structure

```
test-client/
├── index.html    # Main HTML page
├── styles.css    # CSS styles
├── script.js     # JavaScript logic
└── README.md     # This documentation
```

## Security Notes

- **API Keys**: Never expose API keys in production client-side code
- **Master Key**: The master key should only be used server-side
- **postMessage**: Always validate origins in production

This test client is for **development and testing purposes only**.
